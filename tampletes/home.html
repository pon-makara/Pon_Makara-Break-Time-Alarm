{% extends 'base.html' %}
{% block title %}Break Time Dashboard{% endblock %}
{% block content %}
  <div class="dashboard-header">
    <div>
      <h1 class="title">â° Break Time Alarm</h1>
      <p class="muted small">Stay productive with healthy breaks â€¢ {{ user.email }}</p>
    </div>
    <a href="{{ url_for('logout') }}" class="btn-logout">Logout</a>
  </div>

  {% with messages = get_flashed_messages(category_filter=['error','info','success']) %}
    {% if messages %}
      <div class="alerts">
        {% for m in messages %}
          <div class="alert alert-success">{{ m }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Timer Section -->
  <div class="card timer-card">
    <div class="timer-header">
      <h2 class="timer-mode" id="timer-mode">Work Session</h2>
      <div class="timer-status" id="timer-status">Ready</div>
    </div>
    
    <div class="timer-display" id="timer-display">25:00</div>
    
    <div class="timer-controls">
      <button class="btn-timer btn-start" id="start-btn" onclick="startTimer()">
        <span>â–¶</span> Start
      </button>
      <button class="btn-timer btn-pause" id="pause-btn" onclick="pauseTimer()" style="display:none;">
        <span>â¸</span> Pause
      </button>
      <button class="btn-timer btn-reset" onclick="resetTimer()">
        <span>â†»</span> Reset
      </button>
    </div>

    <!-- Stop Alarm Button (hidden by default, shows when alarm rings) -->
    <button class="btn-timer btn-stop-alarm" id="stop-alarm-btn" onclick="stopAlarm()" style="display:none; margin-top:16px;">
      <span>ğŸ”•</span> STOP ALARM
    </button>

    <div class="timer-tabs">
      <button class="timer-tab active" data-mode="work" data-minutes="{{ break_settings.work_duration }}">
        Work ({{ break_settings.work_duration }}m)
      </button>
      <button class="timer-tab" data-mode="short" data-minutes="{{ break_settings.short_break }}">
        Short Break ({{ break_settings.short_break }}m)
      </button>
      <button class="timer-tab" data-mode="long" data-minutes="{{ break_settings.long_break }}">
        Long Break ({{ break_settings.long_break }}m)
      </button>
      <button class="timer-tab" data-mode="custom">
        âš™ï¸ Custom
      </button>
    </div>

    <!-- Custom Timer Input -->
    <div id="custom-timer-input" style="display:none; margin-top:20px;">
      <div class="custom-timer-controls">
        <div class="custom-input-group">
          <label for="custom-minutes">Minutes:</label>
          <input type="number" id="custom-minutes" min="1" max="120" value="25" />
        </div>
        <div class="custom-input-group">
          <label for="custom-seconds">Seconds:</label>
          <input type="number" id="custom-seconds" min="0" max="59" value="0" />
        </div>
        <button class="btn primary" onclick="setCustomTime()">Set Timer</button>
        <button class="btn-reset" onclick="hideCustomTimer()">Cancel</button>
      </div>
      <p class="muted small" style="text-align:center; margin-top:12px;">
        ğŸ”” Alarm will ring when time is up!
      </p>
    </div>
  </div>

  <!-- Statistics Grid -->
  <div class="stats-grid">
    <div class="card stat-card">
      <div class="stat-icon">ğŸ”¥</div>
      <div class="stat-value" id="sessions-completed">0</div>
      <div class="stat-label">Sessions Today</div>
    </div>

    <div class="card stat-card">
      <div class="stat-icon">â˜•</div>
      <div class="stat-value">{{ total_breaks_today }}</div>
      <div class="stat-label">Breaks Taken</div>
    </div>

    <div class="card stat-card">
      <div class="stat-icon">â±ï¸</div>
      <div class="stat-value" id="total-time">0h 0m</div>
      <div class="stat-label">Focus Time</div>
    </div>

    <div class="card stat-card">
      <div class="stat-icon">ğŸ“ˆ</div>
      <div class="stat-value">{{ user_number }}/{{ total_users }}</div>
      <div class="stat-label">Productivity Rank</div>
    </div>
  </div>

  <!-- Daily Scheduled Alarms -->
  <div class="card settings-card">
    <h3 class="section-title">ğŸ”” Daily Scheduled Alarms (3 Times Per Day)</h3>
    <p class="muted small" style="margin-bottom:16px;">Set 3 automatic alarms that ring every day at specific times. Each alarm has a unique melody to match the time of day!</p>
    
    <div class="alarm-schedule-grid">
      <div class="alarm-time-item">
        <label>ğŸŒ… Morning Alarm</label>
        <input type="time" id="morning-alarm" value="09:00" />
        <button class="btn-test-alarm" onclick="testScheduledAlarm('morning')">ğŸ”Š Test</button>
        <span class="muted small">Gentle ascending chime â™«</span>
      </div>
      
      <div class="alarm-time-item">
        <label>â˜€ï¸ Afternoon Alarm</label>
        <input type="time" id="afternoon-alarm" value="14:00" />
        <button class="btn-test-alarm" onclick="testScheduledAlarm('afternoon')">ğŸ”Š Test</button>
        <span class="muted small">Energetic school bell (2Ã—) â™«â™«</span>
      </div>
      
      <div class="alarm-time-item">
        <label>ğŸŒ™ Evening Alarm</label>
        <input type="time" id="evening-alarm" value="18:00" />
        <button class="btn-test-alarm" onclick="testScheduledAlarm('evening')">ğŸ”Š Test</button>
        <span class="muted small">Calm descending wind chime â™«</span>
      </div>
    </div>
    
    <button class="btn primary" onclick="saveScheduledAlarms()" style="margin-top:16px;">
      ğŸ’¾ Save Daily Alarm Schedule
    </button>
    
    <div class="alarm-info" style="margin-top:16px; padding:12px; background:rgba(79,156,255,.08); border-radius:8px;">
      <p class="muted small" style="margin:0;">
        â„¹ï¸ <strong>How it works:</strong> Alarms will ring automatically at your set times every day, even if you close and reopen the page. Each alarm plays once per day with a unique musical melody!
      </p>
    </div>
    
    <div id="alarm-status" style="margin-top:12px; padding:10px; background:rgba(34,197,94,.15); border-radius:8px; text-align:center; color:#86efac; font-size:13px; font-weight:600;">
      ğŸŸ¢ Monitoring active â€¢ Checking every minute...
    </div>
  </div>

  <!-- Settings & Controls -->
  <div class="card settings-card">
    <h3 class="section-title">âš™ï¸ Timer Settings</h3>
    <div class="settings-grid">
      <div class="setting-item">
        <label>Work Duration</label>
        <input type="number" id="work-duration" value="{{ break_settings.work_duration }}" min="1" max="60" />
        <span class="muted small">minutes</span>
      </div>
      <div class="setting-item">
        <label>Short Break</label>
        <input type="number" id="short-break" value="{{ break_settings.short_break }}" min="1" max="30" />
        <span class="muted small">minutes</span>
      </div>
      <div class="setting-item">
        <label>Long Break</label>
        <input type="number" id="long-break" value="{{ break_settings.long_break }}" min="1" max="60" />
        <span class="muted small">minutes</span>
      </div>
      <div class="setting-item">
        <label>Long Break After</label>
        <input type="number" id="sessions-until-long" value="{{ break_settings.sessions_until_long_break }}" min="1" max="10" />
        <span class="muted small">sessions</span>
      </div>
    </div>
    <div class="setting-toggle">
      <label class="switch">
        <input type="checkbox" id="auto-start-breaks" checked />
        <span class="slider"></span>
      </label>
      <span>Auto-start breaks</span>
    </div>
    <div class="setting-toggle">
      <label class="switch">
        <input type="checkbox" id="notifications" checked />
        <span class="slider"></span>
      </label>
      <span>Enable notifications</span>
    </div>
    <button class="btn primary" onclick="saveSettings()">Save Settings</button>
  </div>

  <!-- Quick Actions -->
  <div class="card actions-card">
    <h3 class="section-title">ğŸ“Š Quick Actions</h3>
    <div class="actions-grid">
      <button class="action-btn" onclick="viewHistory()">
        <span class="action-icon">ğŸ“…</span>
        <span>View History</span>
      </button>
      <button class="action-btn" onclick="exportData()">
        <span class="action-icon">ğŸ’¾</span>
        <span>Export Data</span>
      </button>
      <button class="action-btn" onclick="viewStats()">
        <span class="action-icon">ğŸ“ˆ</span>
        <span>Statistics</span>
      </button>
      <button class="action-btn" onclick="testAlarm()">
        <span class="action-icon">ğŸ””</span>
        <span>Test Alarm</span>
      </button>
    </div>
  </div>
{% endblock %}
